<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hern√≠ platforma</title>

<style>
body{
  margin:0;
  padding:20px;
  background:#eee;
  font-family:Arial;
  display:flex;
  justify-content:center;
}
.app{
  width:100%;
  max-width:480px;
  background:#4b2e14;
  color:white;
  padding:20px;
  border-radius:12px;
}
input,select,button{
  width:100%;
  padding:10px;
  margin:6px 0;
}
button{
  background:#8a5a2c;
  border:none;
  color:white;
  cursor:pointer;
}
button:hover{background:#a56c33;}
.hidden{display:none;}
h1,h2,h3{text-align:center;}
hr{margin:15px 0;}
small{opacity:0.85; display:block;}
</style>
</head>

<body>
<div class="app">

<h1>>üé≤ Hern√≠ platforma t3</h1>

<!-- LOGIN -->
<div id="login-screen">
  <input id="nick" placeholder="P≈ôezd√≠vka">
  <button onclick="doLogin()">Vstoupit</button>
</div>

<!-- GAME SELECT -->
<div id="gameSelect" class="hidden">
  <h2>V√Ωbƒõr hry</h2>
  <select id="gameType" onchange="renderGame()">
    <option value="sazky">üéØ S√°zky</option>
    <option value="jednicky_petky">üé≤ Jedniƒçky a pƒõtky</option>
    <option value="maroko">üé≤ Maroko</option>
    <option value="oko">üëÅÔ∏è Oko (21)</option>
    <option value="general">‚≠ê Gener√°l</option>
    <option value="ruleta">üé° Ruleta</option>
  </select>
</div>

<!-- GAME AREA -->
<div id="gameArea"></div>

</div>

<script>
/* ================= JSONBIN ================= */
const BIN_ID = "69406399ae596e708f9c3bbf";
const BIN_KEY = "$2a$10$goc9hv95v4RRqBaqspuG8e/BhhBaoy9tVQoHlPD3WPtYtlXzV.xhS";
const BIN_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

let nickname = "";
let isAdmin = false;

let db = {
  games:{
    sazky:{ rounds:{} },
    jednicky_petky:{},
    maroko:{},
    oko:{},
    general:{},
    ruleta:{}
  }
};

async function loadDB(){
  const r = await fetch(BIN_URL+"/latest",{
    headers:{ "X-Master-Key": BIN_KEY }
  });
  const j = await r.json();
  if(j.record) db = j.record;
}

async function saveDB(){
  await fetch(BIN_URL,{
    method:"PUT",
    headers:{
      "Content-Type":"application/json",
      "X-Master-Key": BIN_KEY
    },
    body: JSON.stringify(db)
  });
}

/* ================= HELPERS ================= */
function toCopper(g,s,c){
  return g*100 + s*10 + c;
}
function fromCopper(v){
  let g = Math.floor(v/100);
  let s = Math.floor((v%100)/10);
  let c = v%10;
  return `Z${g} / S${s} / M${c}`;
}

/* ================= LOGIN ================= */
async function doLogin(){
  nickname = document.getElementById("nick").value.trim();
  if(!nickname) return alert("Zadej p≈ôezd√≠vku");

  isAdmin = nickname.toLowerCase() === "adminif";

  await loadDB();

  document.getElementById("login-screen").classList.add("hidden");
  document.getElementById("gameSelect").classList.remove("hidden");

  renderGame();
}

/* ================= RENDER ================= */
function renderGame(){
  const g = document.getElementById("gameType").value;
  if(g === "sazky") renderSazky();
  else renderPlaceholder(g);
}

/* ================= S√ÅZKY ================= */
function renderSazky(){
  let html = `<h2>üéØ S√°zky</h2>`;

  if(isAdmin){
    html += `
      <h3>Admin ‚Äì vytvo≈ôen√≠ s√°zky</h3>
      <input id="betName" placeholder="N√°zev s√°zky (Franta pije ?)">
      <input id="betOdds" type="number" step="0.1" min="1" placeholder="Kurz">
      <button onclick="createBet()">Vytvo≈ôit s√°zku & hodit üé≤</button>
      <hr>
    `;
  }

  const rounds = db.games.sazky.rounds;
  if(!Object.keys(rounds).length){
    html += `<p><em>≈Ω√°dn√© aktivn√≠ s√°zky</em></p>`;
  }

  for(let name in rounds){
    const r = rounds[name];
    html += `
      <p>
        <strong>${name}</strong><br>
        Kurz: ${r.odds}<br>
        ${isAdmin ? `<strong>üé≤ V√Ωsledek: ${r.result}</strong>` : ""}
      </p>
    `;

    if(!isAdmin){
      html += `
        <select id="guess-${name}">
          ${[1,2,3,4,5,6].map(n=>`<option value="${n}">${n}</option>`).join("")}
        </select>

        <input id="gold-${name}" type="number" min="0" placeholder="Zlat√©">
        <input id="silver-${name}" type="number" min="0" placeholder="St≈ô√≠brn√©">
        <input id="copper-${name}" type="number" min="0" placeholder="Mƒõdƒõn√©">

        <button onclick="placeBet('${name}')">Vsadit</button>
      `;
    }

    if(isAdmin){
      html += r.bets.map(b=>{
        const betC = toCopper(b.bet.g,b.bet.s,b.bet.c);
        let result;
        if(b.guess === r.result){
          result = "üéâ V√Ωhra " + fromCopper(Math.floor(betC * r.odds));
        } else {
          result = "‚ùå Prohra " + fromCopper(betC);
        }
        return `
          <small>
            üë§ ${b.player} |
            vsadil ${fromCopper(betC)} |
            tip ${b.guess} ‚Üí
            ${result}
          </small>
        `;
      }).join("");
    }

    html += `<hr>`;
  }

  document.getElementById("gameArea").innerHTML = html;
}

function createBet(){
  const name = document.getElementById("betName").value.trim();
  const odds = parseFloat(document.getElementById("betOdds").value);
  if(!name || odds < 1) return alert("Neplatn√° data");

  db.games.sazky.rounds[name] = {
    odds,
    result: Math.floor(Math.random()*6) + 1,
    bets:[]
  };

  saveDB();
  renderSazky();
}

function placeBet(name){
  const guess = parseInt(document.getElementById(`guess-${name}`).value);

  const g = +document.getElementById(`gold-${name}`).value || 0;
  const s = +document.getElementById(`silver-${name}`).value || 0;
  const c = +document.getElementById(`copper-${name}`).value || 0;

  if(g+s+c <= 0) return alert("Mus√≠≈° vsadit aspo≈à nƒõco");

  db.games.sazky.rounds[name].bets.push({
    player: nickname,
    guess,
    bet:{ g,s,c },
    time: Date.now()
  });

  saveDB();
  alert("S√°zka p≈ôijata");
}

/* ================= PLACEHOLDERS ================= */
function renderPlaceholder(game){
  const titles = {
    jednicky_petky:"Jedniƒçky a pƒõtky",
    maroko:"Maroko",
    oko:"Oko (21)",
    general:"Gener√°l",
    ruleta:"Ruleta"
  };

  document.getElementById("gameArea").innerHTML = `
    <h2>${titles[game]}</h2>
    <p><em>Hra je p≈ôipravena ‚Äì logika se dopln√≠.</em></p>
  `;
}
</script>
</body>
</html>
